<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;6.&nbsp;GemFire OQL Query</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.70.0"><link rel="start" href="index.html" title="GemFire Developer Course - Lab Documentation"><link rel="up" href="index.html" title="GemFire Developer Course - Lab Documentation"><link rel="prev" href="client-cache_lab.html" title="Chapter&nbsp;5.&nbsp;Client Cache"><link rel="next" href="custom-partitioning-lab.html" title="Chapter&nbsp;7.&nbsp;Custom Partitioned Regions"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns="http://www.w3.org/TR/xhtml1/transitional" style="background-color:white;border:none;height:73px;border:1px solid black;"><a style="border:none;" href="http://www.pivotal.io" title="Pivotal"><img style="border:none;" src="images/heading-logo-lhs.jpg"></img></a><a style="border:none;" href="http://www.pivotal.io/big-data/pivotal-gemfire" title="Pivotal GemFire"><img style="border:none;position:absolute;padding-top:5px;right:42px;" src="images/heading-logo-rhs.jpg"></img></a></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="query_lab"></a>Chapter&nbsp;6.&nbsp;GemFire OQL Query</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="query-lab-introduction"></a>6.1.&nbsp;Introduction</h2></div></div></div><p>In this lab, we will be leveraging Object Query Language (OQL) to access data within
      GemFire. When you are accessing data, you don&#8217;t always have the key available, nor do you know
      what the exact structure of the data is. In this lesson, we will be implementing methods that
      query GemFire data.</p><p><span class="bold"><strong>Concepts you will gain experience with:</strong></span></p><div class="itemizedlist"><ul type="disc"><li><p>Using a query connection in GemFire</p></li><li><p>Writing an OQL style query</p></li><li><p>Performing a query for individual attributes of an object</p></li><li><p>Writing queries involving joins between regions</p></li></ul></div><p><span class="bold"><strong>Estimated completion time</strong></span>: 30 minutes</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="query-lab-quick-instructions"></a>6.2.&nbsp;Quick Instructions</h2></div></div></div><p>Quick instructions for this exercise have been embedded within the lab materials in the
      form of TODO comments. To display them, open the <code class="literal">Tasks</code> view (Window -&gt;
      Show view -&gt; Tasks (<span class="emphasis"><em>not Task List</em></span>)).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="query-lab-detailed-instructions"></a>6.3.&nbsp;Detailed Instructions</h2></div></div></div><p>Instructions for this lab are divided into specific sections. Each section describes the
      steps to perform specific tasks. Before beginning this lab, make sure you have started the
      server side processes using the <code class="literal">startServer.sh</code> script
        (<code class="literal">startServer.bat</code> for Windows) in the
        <code class="filename">server-bootstrap</code> lab folder.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1444"></a>6.3.1.&nbsp;Implementing the general query functionality</h3></div></div></div><p>To start, you will implement a general purpose query method, <code class="code">doQuery()</code> that
        simply takes a <code class="classname">String</code> as an argument and returns a
          <code class="classname">SelectResults</code> result set. While not robust enough for broad usage,
        it will suit the purpose for this lab to have this functionality encapsulated in a method
        such that the remaining sections can focus primarily on writing the query string.</p><p>(<code class="literal">TODO-01</code>) Open the <code class="filename">OQLInquirer.java</code> class file
        (in the <code class="filename">com.gopivotal.bookshop.buslogic</code> package) and locate the
          <code class="code">doQuery()</code> method, which has been stubbed out for you. Implement the
        functionality of this method to perform the following tasks:</p><div class="itemizedlist"><ul type="disc"><li><p>Get a <code class="classname">QueryService</code> from the cache</p></li><li><p>Create a new query using the supplied query string</p></li><li><p>Execute the query, which will have to be done inside a <code class="code">try/catch</code>
              block</p></li><li><p>Either return the results of executing the query or throw a
                <code class="classname">QueryException</code> wrapping an exceptions caught in the catch
              block</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1494"></a>6.3.2.&nbsp;Basic OQL Query with Objects</h3></div></div></div><p>This section will do a query against the <code class="literal">Customer</code> region to access
        data as <code class="classname">Customer</code> Objects.</p><div class="itemizedlist"><ul type="disc"><li><p>(<code class="literal">TODO-02</code>) In the same file, locate the
                <code class="code">doCustomerQuery()</code> method. In this method, you will only need to do two
              things. </p><div class="orderedlist"><ol type="1"><li><p>Write a proper OQL query in the query string to fetch all entries from the
                      <code class="literal">Customer</code> region </p></li><li><p>Return the results of calling the <code class="code">doQuery()</code> method with the
                    query string you just wrote</p></li></ol></div></li><li><p>(<code class="literal">TODO-03</code>) Open the <code class="filename">OqlInquirerTests.java</code>
              class file in the <code class="filename">com.gopviotal.bookshop.tests</code> package. Execute
              the tests. If you correctly implemented the <code class="code">doCustomerQuery()</code> method in
              the prior step, the first test, <code class="code">testBasicQuery()</code> should pass. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Don&#8217;t worry yet that the other two tests are failing. You will fix this in the
                  remaining sections.</p></td></tr></table></div></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1549"></a>6.3.3.&nbsp;OQL Query with Struct objects</h3></div></div></div><p>Once you have the basic customer query working, you can move on to write a similar query
        to only return certain fields of the Customer object.</p><div class="itemizedlist"><ul type="disc"><li><p>(<code class="literal">TODO-04</code>) Locate the doStructQuery() method in the
                <code class="classname">OQLInquirer</code> class. Implement the method using the following steps.</p><div class="orderedlist"><ol type="1"><li><p>First, write the correct query string to return a projection list. That is,
                    perform a query where you will return only the
                    <code class="literal">customerNumber</code>, <code class="literal">firstName</code> and
                      <code class="literal">lastName</code> fields of the <code class="classname">Customer</code>
                    entries.</p></li><li><p>Return the results of calling <code class="code">doQuery()</code> with the query string
                    you just wrote</p></li></ol></div></li><li><p>(<code class="literal">TODO-05</code>) Return to the <code class="classname">OqlInquirerTests</code>
              class and re-run the tests to verify you correctly implemented this functionality. If
              so, then both the <code class="code">testBasicQuery()</code> and <code class="code">testStructQuery()</code>
              tests should now pass. The <code class="code">testJoinQuery()</code> test will still fail until you
              complete the last section.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1604"></a>6.3.4.&nbsp;Performing Joins</h3></div></div></div><p>In this final section, you will be creating a more complex query by performing a join
        operation between the Customer region and BookOrder region. The goal is to return a list of
        all customers who have placed an order with total price greater than $45.00. To better
        understand the requirements for this query, take a moment to examine the following diagram
        showing the class definitions found within these two regions.</p><div class="mediaobject"><img src="images/join_query.jpg"></div><p>You will be performing an equ-join query in which you link
          <code class="classname">Customer</code> entries in the <code class="literal">/Customer</code> region to the
          <code class="classname">BookOrder</code> entries in the <code class="literal">/BookOrder</code> region by
        the <code class="literal">customerNumber</code> property of each object. With this in mind, perform
        the following tasks.</p><div class="itemizedlist"><ul type="disc"><li><p>(<code class="literal">TODO-06</code>) Locate the <code class="code">doJoinQuery()</code> method in the
                <code class="classname">OQLInquirer</code> class. Implement the method using the following steps.</p><div class="orderedlist"><ol type="1"><li><p>First write the correct query string to perform the join query. You are
                    selecting a unique list of customers who's total order is greater than
                    $45.00.</p></li><li><p>Return the results of calling <code class="code">doQuery()</code> with the query string -
                    you should be returning a <code class="classname">SelectResults</code> for
                      <code class="classname">Customer</code> objects.</p></li></ol></div></li><li><p>(<code class="literal">TODO-07</code>) Return to the <code class="classname">OqlInquirerTests</code>
              class and re-run the tests to verify you correctly implemented the join query
              functionality. If so, then all 3 tests should now pass.</p></li></ul></div><p>Congratulations!! You have completed this lab.</p></div></div></div><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter"><hr></hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="client-cache_lab.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="custom-partitioning-lab.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;5.&nbsp;Client Cache&nbsp;</td><td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="http://www.pivotal.io/big-data/pivotal-gemfire" title="Pivotal GemFire">Pivotal</a></span></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;7.&nbsp;Custom Partitioned Regions</td></tr></table></div></body></html>